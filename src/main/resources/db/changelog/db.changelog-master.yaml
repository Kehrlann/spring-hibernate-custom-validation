# Example changelog split into multiple files :
# https://github.com/swri-robotics/bag-database/blob/master/src/main/resources/db/changelog/db.changelog-master.yaml
databaseChangeLog:
  - changeSet:
      id: create-user-table
      author: daniel
      changes:
        - sql:
          sql: |
                CREATE TABLE application_user (
                  id SERIAL PRIMARY KEY,
                  email TEXT UNIQUE NOT NULL,
                  creation_date TIMESTAMP WITHOUT TIME ZONE NOT NULL DEFAULT (now() at time zone 'utc')
                );
  - changeSet:
      id: create-device-table
      author: daniel
      changes:
        - sql:
          sql: |
                CREATE TABLE device (
                  id SERIAL PRIMARY KEY,
                  user_id INT NOT NULL REFERENCES application_user(id) ON DELETE CASCADE,
                  name TEXT UNIQUE NOT NULL,
                  creation_date TIMESTAMP WITHOUT TIME ZONE NOT NULL DEFAULT (now() at time zone 'utc')
                );
  - changeSet:
      id: create-event-table
      author: daniel
      changes:
        - sql:
          sql: |
                CREATE TABLE event (
                  id SERIAL PRIMARY KEY,
                  device_id INT NOT NULL REFERENCES device(id) ON DELETE CASCADE,
                  value INT NOT NULL,
                  creation_date TIMESTAMP WITHOUT TIME ZONE NOT NULL DEFAULT (now() at time zone 'utc')
                );
                CREATE INDEX event_timestamp ON event(creation_date);

  - changeSet:
      id: seed-data
      author: daniel
      runAlways: true
      changes:
        - sql:
          sql: DELETE FROM application_user;
        - sqlFile:
            path: seeds.sql
            relativeToChangelogFile: true
            splitStatements: false